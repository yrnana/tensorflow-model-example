{"version":3,"file":"canvas.77fa6c83.js","sources":["../../src/helpers/utils.ts","../../src/components/Video.tsx","../../src/helpers/canvas.ts"],"sourcesContent":["export async function setupCamera(\n  video: HTMLVideoElement,\n  constraints?: MediaStreamConstraints,\n) {\n  return new Promise<MediaStream>((resolve, reject) => {\n    if (navigator.mediaDevices?.getUserMedia) {\n      navigator.mediaDevices\n        .getUserMedia(\n          constraints || {\n            audio: false,\n            video: {\n              width: 960,\n              height: 540,\n              facingMode: 'user',\n            },\n          },\n        )\n        .then((stream) => {\n          video.srcObject = stream;\n          resolve(stream);\n        })\n        .catch(reject);\n    } else {\n      reject(new Error('mediaDevices not support'));\n    }\n  });\n}\n\nexport function mergeRefs<T>(refs: Array<React.ForwardedRef<T>>) {\n  return (value: T) => {\n    refs.forEach((ref) => {\n      if (typeof ref === 'function') {\n        ref(value);\n      } else if (ref != null) {\n        ref.current = value;\n      }\n    });\n  };\n}\n","import { forwardRef, useCallback, useEffect, useRef } from 'react';\nimport { mergeRefs, setupCamera } from '~/helpers/utils';\n\ntype VideoProps = React.DetailedHTMLProps<\n  React.VideoHTMLAttributes<HTMLVideoElement>,\n  HTMLVideoElement\n>;\n\nconst Video = forwardRef<HTMLVideoElement, VideoProps>(\n  ({ onLoadedMetadata, ...props }, ref) => {\n    const videoRef = useRef<HTMLVideoElement | null>(null);\n\n    const onLoaded = useCallback(\n      (e: React.SyntheticEvent<HTMLVideoElement, Event>) => {\n        const video = videoRef.current;\n        if (!video) return;\n\n        video.width = video.videoWidth;\n        video.height = video.videoHeight;\n        onLoadedMetadata?.(e);\n      },\n      [onLoadedMetadata],\n    );\n\n    useEffect(() => {\n      const video = videoRef.current;\n      if (video) {\n        setupCamera(video);\n      }\n    }, [ref]);\n\n    return (\n      <video\n        {...props}\n        autoPlay\n        playsInline\n        muted\n        onLoadedMetadata={onLoaded}\n        className=\"transform -scale-x-100\"\n        ref={mergeRefs([videoRef, ref])}\n      />\n    );\n  },\n);\n\nVideo.displayName = 'Video';\n\nexport default Video;\n","import type { Coords3D } from '~/types';\n\nexport function setupCanvas(\n  video: HTMLVideoElement,\n  canvas: HTMLCanvasElement,\n  callback?: (ctx: CanvasRenderingContext2D) => void,\n) {\n  const ctx = canvas.getContext('2d');\n  if (!ctx) return;\n\n  canvas.width = video.videoWidth;\n  canvas.height = video.videoHeight;\n  ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';\n\n  callback?.(ctx);\n}\n\nexport function drawPath(\n  ctx: CanvasRenderingContext2D,\n  points: Coords3D,\n  closePath: boolean,\n) {\n  const region = new Path2D();\n  region.moveTo(points[0][0], points[0][1]);\n  for (let i = 1; i < points.length; i++) {\n    const point = points[i];\n    region.lineTo(point[0], point[1]);\n  }\n  if (closePath) {\n    region.closePath();\n  }\n  ctx.stroke(region);\n}\n\nexport function drawPoint(\n  ctx: CanvasRenderingContext2D,\n  y: number,\n  x: number,\n  r: number,\n) {\n  ctx.beginPath();\n  ctx.arc(x, y, r, 0, 2 * Math.PI);\n  ctx.fill();\n}\n"],"names":["Video","forwardRef","ref","onLoadedMetadata","props","videoRef","useRef","onLoaded","useCallback","e","video","current","width","videoWidth","height","videoHeight","mergeRefs","displayName"],"mappings":"irBACE,EACA,EACA,OACO,IAAI,SAAqB,CAAC,EAAS,IAAW,OAC/C,cAAU,eAAV,cAAwB,wBAChB,aACP,aACC,GAAe,CACb,MAAO,GACP,MAAO,CACL,MAAO,IACP,OAAQ,IACR,WAAY,UAIjB,KAAK,AAAC,GAAW,GACV,UAAY,IACV,KAET,MAAM,KAEF,GAAI,OAAM,0CAKM,EAAoC,OACxD,AAAC,IAAa,GACd,QAAQ,AAAC,GAAQ,CAChB,MAAO,IAAQ,aACb,GACK,GAAO,SACZ,QAAU,WC1BhBA,GAAQC,qBACZ,CAAC,EAAgCC,IAAQ,CAAxC,QAAEC,qBAAF,EAAuBC,IAAvB,EAAuBA,CAArBD,0BACKE,GAAWC,iBAAgC,MAE3CC,EAAWC,sBACf,AAACC,GAAqD,MAC9CC,GAAQL,EAASM,QACnB,CAACD,MAECE,MAAQF,EAAMG,aACdC,OAASJ,EAAMK,uBACFN,KAErB,CAACN,+BAGO,IAAM,MACRO,GAAQL,EAASM,QACnBD,KACUA,IAEb,CAACR,qBAIIE,IACJ,YACA,eACA,SACA,iBAAkBG,EAClB,UAAU,yBACV,IAAKS,EAAU,CAACX,EAAUH,SAMlCF,EAAMiB,YAAc,mBC1ClB,EACA,EACA,EACA,MACM,GAAM,EAAO,WAAW,MAC1B,CAAC,MAEE,MAAQ,EAAM,aACd,OAAS,EAAM,cAClB,UAAY,gCAEL,eAIX,EACA,EACA,EACA,MACM,GAAS,GAAI,UACZ,OAAO,EAAO,GAAG,GAAI,EAAO,GAAG,WAC7B,GAAI,EAAG,EAAI,EAAO,OAAQ,IAAK,MAChC,GAAQ,EAAO,KACd,OAAO,EAAM,GAAI,EAAM,IAE5B,KACK,cAEL,OAAO,cAIX,EACA,EACA,EACA,EACA,GACI,cACA,IAAI,EAAG,EAAG,EAAG,EAAG,EAAI,KAAK,MACzB"}